<ion-header collapse="fade" [translucent]="true">
  <ion-toolbar color="dark">
    <ion-title color="light">Inventario Menu</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <br />

  <ion-button
    color="danger"
    [routerLink]="['/inventarioregistro', { accion: 'nuevo' }]"
  >
    <ion-icon color="light" name="duplicate-outline"></ion-icon>
    <strong>Registrar Inventario</strong>
  </ion-button>

  <ion-button (click)="openDateModal()">Seleccionar Fecha</ion-button>

  <ion-grid class="transparent-grid custom-table">
    <!-- Fila para la fecha seleccionada -->
    <ion-row>
      <ion-col class="header col-label" color="light">Fecha</ion-col>
      <ion-col class="data col-value">{{ selectedDate }}</ion-col>
    </ion-row>
    <br />

    <!-- Fila para cada producto y su detalle -->
    <ng-container *ngFor="let producto of productos">
      <ion-row class="header-row">
        <ion-col class="header col-label" color="light">Producto</ion-col>
        <ion-col class="data col-value">
          {{ producto.nombre }}
          <ion-button
            size="small"
            fill="clear"
            color="primary"
            (click)="toggleProductInfo(producto)"
          >
            <ion-icon
              slot="icon-only"
              [name]="productInfoVisible[producto.id] ? 'chevron-up-outline' : 'chevron-down-outline'"
            ></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>

      <!-- Detalles del producto, visibles solo si está seleccionado -->
      <ion-row *ngIf="productInfoVisible[producto.id]">
        <ion-col class="header col-label" color="light"
          >Cantidad inicial</ion-col
        >
        <ion-col class="data col-value"
          >{{ producto.RI_CANTIDAD_INICIAL }}</ion-col
        >
      </ion-row>

      <ion-row *ngIf="productInfoVisible[producto.id]">
        <ion-col class="header col-label" color="light">Precio</ion-col>
        <ion-col class="data col-value">{{ producto.pvp }}</ion-col>
      </ion-row>

      <ion-row *ngIf="productInfoVisible[producto.id]">
        <ion-col class="header col-label" color="light"
          >Cantidad vendida</ion-col
        >
        <ion-col class="data col-value"
          >{{ producto.RF_CANTIDAD_VENDIDA }}</ion-col
        >
      </ion-row>

      <ion-row *ngIf="productInfoVisible[producto.id]">
        <ion-col class="header col-label" color="light">Ganancia</ion-col>
        <ion-col class="data col-value"
          >{{ producto.RS_GANANCIA_PERDIDA }}</ion-col
        >
      </ion-row>

      <ion-row *ngIf="productInfoVisible[producto.id]">
        <ion-col class="header col-label" color="light">Desechos</ion-col>
        <ion-col class="data col-value"
          >{{ producto.total_muestra_desechados }}</ion-col
        >
      </ion-row>

      <ion-row *ngIf="productInfoVisible[producto.id]">
        <ion-col class="header col-label" color="light">Perdida</ion-col>
        <ion-col class="data col-value"
          >{{ producto.RS_TOTAL_PERDIDA }}</ion-col
        >
      </ion-row>

      <ion-row *ngIf="productInfoVisible[producto.id]">
        <ion-col class="header col-label" color="light">Opciones</ion-col>
        <ion-col class="data col-value">
          <div class="action-buttons">
            <!-- Botón de editar -->
            <ion-button
              size="small"
              fill="clear"
              color="tertiary"
              [routerLink]="['/editinventario', { ri_codigo: producto.RI_CODIGO, rf_codigo: producto.RF_CODIGO }]"
            >
              <ion-icon slot="icon-only" name="create-outline"></ion-icon>
            </ion-button>
            <ion-button
              size="small"
              fill="clear"
              color="danger"
              (click)="eliminarProducto(producto.RI_CODIGO)"
            >
              <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
            </ion-button>
          </div>
        </ion-col>
      </ion-row>
    </ng-container>
  </ion-grid>

  <!-- Modal para seleccionar fecha -->
  <ion-modal
    [isOpen]="isDateModalOpen"
    (ionModalDidDismiss)="onDateModalDismiss()"
  >
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Seleccionar Fecha</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeDateModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-datetime
          [(ngModel)]="modalDate"
          display-format="YYYY-MM-DD"
        ></ion-datetime>
        <ion-button expand="full" (click)="saveDate()">Guardar</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
